<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@mladenilic/threesixty.js/dist/threesixty.js"></script>
  <style>
    #viewer { width: 600px; height: 600px; margin: 24px auto; }
    .toolbar { display: flex; justify-content: center; margin-top: 12px; }
    .controls { max-width: 720px; margin: 0 auto; }
  </style>
</head>
<body class="bg-light">

<nav class="navbar bg-white border-bottom">
  <div class="container-fluid">
    <button class="btn btn-outline-secondary btn-sm" type="button"
            data-bs-toggle="offcanvas" data-bs-target="#mainMenu" aria-controls="mainMenu"
            aria-label="Open menu">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<div class="offcanvas offcanvas-start" tabindex="-1" id="mainMenu" aria-labelledby="mainMenuLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="mainMenuLabel">Menu</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <nav class="nav flex-column">
      <a class="nav-link text-primary" href="compare.html">Compare Tool</a>
    </nav>
  </div>
</div>


<div class="controls container mt-3">
  <div class="row g-2 align-items-center">
    <div class="col-auto"><label for="objectSelect" class="col-form-label">Object</label></div>
    <div class="col">
      <select id="objectSelect" class="form-select"></select>
    </div>
  </div>
</div>

<div id="viewer" class="bg-white rounded-3"></div>

<div class="toolbar">
  <div class="btn-group btn-group-sm" role="group" aria-label="View controls">
    <button class="btn btn-outline-secondary" data-view="front">Front</button>
    <button class="btn btn-outline-secondary" data-view="back">Back</button>
    <button class="btn btn-outline-secondary" data-view="left">Left</button>
    <button class="btn btn-outline-secondary" data-view="right">Right</button>
  </div>
</div>

<script>
  const CONFIG = {
    objects: [
      {
        name: "iphone",
        image: "./sprites/iphone/sprite.webp",
        views: { front: 0, back: 48, left: 24, right: 72 },
        inverted: true
      },
      {
        name: "ring",
        image: "./sprites/ring/ring.webp",
        views: { front: 13, back: 60, left: 37, right: 85 },
        inverted: false
      }
    ]
  }

  const COUNT = 96, PERROW = 12
  const viewer = document.getElementById('viewer')
  const objectSelect = document.getElementById('objectSelect')

  CONFIG.objects.forEach((o, i) => {
    const opt = document.createElement('option')
    opt.value = i
    opt.textContent = o.name
    objectSelect.appendChild(opt)
  })

  let current = CONFIG.objects[0]
  let ts = initThreeSixty(current)

  function initThreeSixty(obj) {
    viewer.innerHTML = ""
    const instance = new ThreeSixty(viewer, {
      image: obj.image,
      width: 400,
      height: 400,
      count: COUNT,
      perRow: PERROW,
      draggable: true,
      swipeable: true,
      keys: true,
      speed: 50,
      inverted: !!obj.inverted
    })
    instance.goto(obj.views.front)
    instance.play(true, 2)
    return instance
  }

  objectSelect.addEventListener('change', () => {
    current = CONFIG.objects[objectSelect.value | 0]
    ts.stop()
    ts = initThreeSixty(current)
  })

  document.querySelector('.btn-group').addEventListener('click', e => {
    const v = e.target.dataset.view
    if (!v) return
    ts.stop()
    const idx = current.views[v]
    if (Number.isInteger(idx)) ts.goto(idx)
  })
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
