<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .viewer-panel .panel-inner {
        width: 100%;
        margin: 0;
      }
      .viewer {
        width: 100%;
        aspect-ratio: 1 / 1;
        max-height: 85vh;
        max-width: 85vh;
        margin: 0 auto;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>

  <body>
    <nav class="navbar border-bottom">
      <div class="container-fluid position-relative">
        <button
          class="btn btn-outline-secondary btn-sm position-absolute start-0 ms-2"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#mainMenu"
          aria-controls="mainMenu"
          aria-label="Open menu"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="mx-auto d-flex gap-4 align-items-center">
          <select
            id="selectA"
            class="form-select form-select-sm"
            style="min-width: 220px"
            aria-label="Select left object"
          ></select>
          <select
            id="selectB"
            class="form-select form-select-sm"
            style="min-width: 220px"
            aria-label="Select right object"
          ></select>
        </div>
      </div>
    </nav>

    <div
      class="offcanvas offcanvas-start"
      tabindex="-1"
      id="mainMenu"
      aria-labelledby="mainMenuLabel"
    >
      <div class="offcanvas-header">
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <nav class="nav flex-column">
          <a class="nav-link text-primary" href="sketchfab.html">Sketchfab</a>
        </nav>
        <nav class="nav flex-column">
          <a class="nav-link text-primary" href="google-model-viewer.html"
            >Google Model Viewer</a
          >
        </nav>
      </div>
    </div>

    <div class="container-fluid mt-2">
      <div id="panelsRow" class="row g-0">
        <div id="colA" class="col-12 col-md-6">
          <div id="panelA" class="viewer-panel p-3">
            <div class="panel-inner">
              <div class="viewer rounded-3" id="viewerA"></div>
            </div>
          </div>
        </div>
        <div id="colB" class="col-12 col-md-6">
          <div id="panelB" class="viewer-panel p-3">
            <div class="panel-inner">
              <div class="viewer rounded-3" id="viewerB"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://scripts.sirv.com/sirvjs/v3/sirv.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const CONFIG = {
        objects: [
          {
            name: "iPhone 17 Pro Max",
            url: "https://hunterttp.sirv.com/phones/iphone-17-pro-max/iphone-17-pro-max.spin",
            reverse: false,
          },
          {
            name: "Samsung Galaxy S25 Ultra",
            url: "https://hunterttp.sirv.com/phones/samsung-galaxy-s25-ultra/samsung-galaxy-s25-ultra.spin",
            reverse: false,
          },
          {
            name: "Thermaltake Cooling Pad",
            url: "https://demo.sirv.com/spins/SpinDownloader/studioshino/Thermaltake_LC/Thermaltake_LC.spin",
            reverse: false,
          },
        ],
      };

      function mountViewer(hostId, obj) {
        const host = document.getElementById(hostId);
        if (!obj) {
          host.innerHTML = "";
          return;
        }
        const opts = obj.reverse ? ' data-options="column.reverse:true"' : "";
        host.innerHTML = `<div class="Sirv w-100 h-100" id="${hostId}__sirv"><div data-src="${obj.url}"${opts}></div></div>`;
        Sirv.start(`#${hostId}__sirv`);
      }
      function unmountViewer(hostId) {
        document.getElementById(hostId).innerHTML = "";
      }

      function populateSelect(selectEl, initialIndex) {
        selectEl.innerHTML = ['<option value="-1">None</option>']
          .concat(
            CONFIG.objects.map(
              (o, i) => `<option value="${i}">${o.name}</option>`
            )
          )
          .join("");
        selectEl.value = String(initialIndex);
      }

      function setColClasses(colEl, show, fullWidthWhenAlone) {
        if (!show) {
          colEl.className = "d-none";
        } else {
          colEl.className = fullWidthWhenAlone ? "col-12" : "col-12 col-md-6";
        }
      }

      function applyLayoutAndRemount() {
        const aIdx = parseInt(document.getElementById("selectA").value, 10);
        const bIdx = parseInt(document.getElementById("selectB").value, 10);

        const showA = Number.isInteger(aIdx) && aIdx >= 0;
        const showB = Number.isInteger(bIdx) && bIdx >= 0;

        const colA = document.getElementById("colA");
        const colB = document.getElementById("colB");

        const aFull = showA && !showB;
        const bFull = showB && !showA;

        setColClasses(colA, showA, aFull);
        setColClasses(colB, showB, bFull);

        requestAnimationFrame(() => {
          unmountViewer("viewerA");
          unmountViewer("viewerB");
          if (showA) mountViewer("viewerA", CONFIG.objects[aIdx]);
          if (showB) mountViewer("viewerB", CONFIG.objects[bIdx]);
        });
      }

      function handleChange() {
        applyLayoutAndRemount();
      }

      populateSelect(document.getElementById("selectA"), 0);
      populateSelect(document.getElementById("selectB"), 1);
      document
        .getElementById("selectA")
        .addEventListener("change", handleChange);
      document
        .getElementById("selectB")
        .addEventListener("change", handleChange);
      applyLayoutAndRemount();
    </script>
  </body>
</html>
