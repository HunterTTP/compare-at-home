<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .viewer-panel .panel-inner { width: min(420px, 100%); margin: 0 auto; }
    .viewer { width: 100%; aspect-ratio: 1 / 1; margin: 12px auto; }
    .range-wrap { max-width: 720px; margin: 16px auto; }
  </style>
</head>
<body>
<div class="container mt-3">
  <div class="row g-4">
    <div class="col-12 col-md-6">
      <div id="panelA" class="viewer-panel card p-3">
        <div class="panel-inner">
          <select class="form-select objectSelect mb-2" aria-label="Select object (left)"></select>
          <div class="viewer rounded-3" id="viewerA"></div>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div id="panelB" class="viewer-panel card p-3">
        <div class="panel-inner">
          <select class="form-select objectSelect mb-2" aria-label="Select object (right)"></select>
          <div class="viewer rounded-3" id="viewerB"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="range-wrap">
    <input id="syncRange" type="range" class="form-range " min="1" max="240" step="1" value="1" aria-label="Rotate both viewers">
  </div>
</div>

<script src="https://scripts.sirv.com/sirvjs/v3/sirv.js"></script>
<script>
  const CONFIG = {
    objects: [{
      name: "iPhone 17 Pro Max",
      slug: "iphone-17-pro-max",
      url: "https://hunterttp.sirv.com/phones/iphone-17-pro-max/iphone-17-pro-max.spin",
      reverse: false
    }]
  }

  function renderViewer(elId, obj) {
    const opts = obj.reverse ? ' data-options="column.reverse:true"' : ''
    document.getElementById(elId).innerHTML =
      `<div class="Sirv" id="${elId}__sirv"><div data-src="${obj.url}"${opts}></div></div>`
    Sirv.start(`#${elId}__sirv`)
  }

  function setupPanel(rootId, initialIndex = 0) {
    const root = document.getElementById(rootId)
    const selectEl = root.querySelector('.objectSelect')
    selectEl.innerHTML = CONFIG.objects.map((o,i)=>`<option value="${i}">${o.name}</option>`).join('')
    selectEl.value = initialIndex
    renderViewer(root.querySelector('.viewer').id, CONFIG.objects[initialIndex])
  }

  setupPanel('panelA', 0)
  setupPanel('panelB', 0)

  let spinA = null, spinB = null

  Sirv.on('spin:ready', () => {
    const vA = Sirv.viewer.getInstance('#viewerA__sirv')
    const vB = Sirv.viewer.getInstance('#viewerB__sirv')
    if (vA?.child(0)?.spin?.isReady()) spinA = vA.child(0).spin
    if (vB?.child(0)?.spin?.isReady()) spinB = vB.child(0).spin
  })

  const slider = document.getElementById('syncRange')

  function sliderValueToCol(val, maxCols) {
    return (maxCols - (val - 1))
  }

  slider.addEventListener('input', e => {
    const maxCols = parseInt(slider.max, 10) || 240
    const col = sliderValueToCol(parseInt(e.target.value, 10), maxCols)
    if (spinA?.isReady()) spinA.jumpCols(col)
    if (spinB?.isReady()) spinB.jumpCols(col)
  })
</script>
</body>
</html>
