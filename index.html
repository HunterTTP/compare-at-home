<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@mladenilic/threesixty.js/dist/threesixty.js"></script>
  <style>
    /* One narrow, centered column per panel so all elements share the same width */
    .viewer-panel .panel-inner { width: min(420px, 100%); margin: 0 auto; }
    /* Viewer fills the inner column; JS sets canvas size based on this width */
    .viewer { width: 100%; aspect-ratio: 1 / 1; margin: 12px auto; }
    .toolbar { display: flex; justify-content: center; margin-top: 8px; width: 100%; }
  </style>
</head>
<body>

<nav class="navbar border-bottom">
  <div class="container-fluid">
    <button class="btn btn-outline-secondary btn-sm" type="button"
            data-bs-toggle="offcanvas" data-bs-target="#mainMenu" aria-controls="mainMenu"
            aria-label="Open menu">
      <span class="navbar-toggler-icon"></span> Menu
    </button>
  </div>
</nav>

<div class="offcanvas offcanvas-start" tabindex="-1" id="mainMenu" aria-labelledby="mainMenuLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="mainMenuLabel">Menu</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <nav class="nav flex-column">
      <a class="nav-link text-primary" href="compare.html">Compare Tool</a>
    </nav>
  </div>
</div>

<div class="container mt-3">
  <div class="row g-4">
    <!-- Panel A -->
    <div class="col-12 col-md-6">
      <div id="panelA" class="viewer-panel card p-3">
        <div class="panel-inner">
          <select class="form-select objectSelect mb-2" aria-label="Select object (left)"></select>
          <div class="viewer rounded-3"></div>
          <div class="toolbar">
            <div class="btn-group btn-group-sm" role="group" aria-label="View controls left">
              <button class="btn btn-outline-secondary" data-view="front">Front</button>
              <button class="btn btn-outline-secondary" data-view="back">Back</button>
              <button class="btn btn-outline-secondary" data-view="left">Left</button>
              <button class="btn btn-outline-secondary" data-view="right">Right</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel B -->
    <div class="col-12 col-md-6">
      <div id="panelB" class="viewer-panel card p-3">
        <div class="panel-inner">
          <select class="form-select objectSelect mb-2" aria-label="Select object (right)"></select>
          <div class="viewer rounded-3"></div>
          <div class="toolbar">
            <div class="btn-group btn-group-sm" role="group" aria-label="View controls right">
              <button class="btn btn-outline-secondary" data-view="front">Front</button>
              <button class="btn btn-outline-secondary" data-view="back">Back</button>
              <button class="btn btn-outline-secondary" data-view="left">Left</button>
              <button class="btn btn-outline-secondary" data-view="right">Right</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const CONFIG = {
    objects: [
      { name: "iPhone 16 Pro", image: "./sprites/iphone/sprite.webp",
        views: { front: 0, back: 48, left: 24, right: 72 }, inverted: true },
      { name: "Samsung Galaxy 25 Ultra", image: "./sprites/android/sprite.webp",
        views: { front: 0, back: 48, left: 22, right: 70 }, inverted: true }
    ]
  }

  const COUNT = 96, PERROW = 12

  function initThreeSixty(container, obj) {
    // Use the container's actual width so canvas matches dropdown/buttons width
    const size = Math.max(200, Math.round(container.clientWidth || 400))
    container.innerHTML = ""
    const inst = new ThreeSixty(container, {
      image: obj.image,
      width: size,
      height: size,
      count: COUNT,
      perRow: PERROW,
      draggable: true,
      swipeable: true,
      keys: true,
      speed: 50,
      dragTolerance: 3,
      swipeTolerance: 3,
      inverted: !!obj.inverted
    })
    inst.goto(obj.views.front)
    inst.play(true, 1)
    return inst
  }

  function setupPanel(root, initialIndex = 0) {
    const viewerEl = root.querySelector('.viewer')
    const selectEl = root.querySelector('.objectSelect')
    selectEl.innerHTML = CONFIG.objects.map((o, i) =>
      `<option value="${i}">${o.name}</option>`).join('')
    selectEl.value = initialIndex

    let current = CONFIG.objects[initialIndex]
    let ts = initThreeSixty(viewerEl, current)

    selectEl.addEventListener('change', () => {
      current = CONFIG.objects[selectEl.value | 0]
      ts.stop(); ts = initThreeSixty(viewerEl, current)
    })

    root.querySelector('.btn-group').addEventListener('click', e => {
      const v = e.target?.dataset?.view; if (!v) return
      ts.stop(); const idx = current.views[v]
      if (Number.isInteger(idx)) ts.goto(idx)
    })
  }

  setupPanel(document.getElementById('panelA'), 0)
  setupPanel(document.getElementById('panelB'), 1)
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
